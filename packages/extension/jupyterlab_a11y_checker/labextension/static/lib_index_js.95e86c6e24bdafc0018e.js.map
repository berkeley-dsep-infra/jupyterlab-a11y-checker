{"version":3,"file":"lib_index_js.95e86c6e24bdafc0018e.js","mappings":"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","sources":["webpack://jupyterlab-a11y-checker/./src/adapter.ts","webpack://jupyterlab-a11y-checker/./src/components/fix/base.ts","webpack://jupyterlab-a11y-checker/./src/components/fix/buttonFixes.ts","webpack://jupyterlab-a11y-checker/./src/components/fix/dropdownFixes.ts","webpack://jupyterlab-a11y-checker/./src/components/fix/textfieldFixes.ts","webpack://jupyterlab-a11y-checker/./src/components/issueWidget.ts","webpack://jupyterlab-a11y-checker/./src/components/mainpanelWidget.ts","webpack://jupyterlab-a11y-checker/./src/image-processor.ts","webpack://jupyterlab-a11y-checker/./src/index.ts"],"sourcesContent":["import { NotebookPanel } from '@jupyterlab/notebook';\nimport { IGeneralCell } from '@berkeley-dsep-infra/a11y-checker-core';\n\n/**\n * Converts JupyterLab NotebookPanel widgets into an environment-agnostic array of accessible cells.\n * This allows detection logic to run on pure data without depending on JupyterLab UI widgets.\n */\nexport function notebookToGeneralCells(panel: NotebookPanel): IGeneralCell[] {\n  return panel.content.widgets.map((cell, index) => {\n    // Get source from shared model for latest content (real-time/unsaved changes)\n    const source = cell.model.sharedModel.getSource();\n    // Cast type explicitly to match our strict union type\n    const type = cell.model.type as 'code' | 'markdown' | 'raw';\n\n    // Extract attachments if they exist\n    // cell.model.toJSON() returns an ICell object which might have attachments\n    const cellData = cell.model.toJSON() as any;\n    const attachments = cellData.attachments;\n\n    return {\n      cellIndex: index,\n      type,\n      source,\n      attachments\n    };\n  });\n}\n","import { Widget } from '@lumino/widgets';\nimport { Cell, ICellModel } from '@jupyterlab/cells';\nimport { ICellIssue } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { analyzeCellIssues } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { notebookToGeneralCells } from '../../adapter.js';\nimport { PageConfig } from '@jupyterlab/coreutils';\n// Intentionally keep base free of category-specific analysis. Widgets can override.\nimport { BrowserImageProcessor } from '../../image-processor.js';\n\nabstract class FixWidget extends Widget {\n  protected issue: ICellIssue;\n  protected cell: Cell<ICellModel>;\n  protected aiEnabled: boolean;\n  protected currentPath: string = '';\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super();\n    this.issue = issue;\n    this.cell = cell;\n    this.aiEnabled = aiEnabled;\n    this.addClass('a11y-fix-widget');\n  }\n\n  protected abstract getDescription(): string;\n\n  // Method to remove the widget from the DOM\n  protected removeIssueWidget(): void {\n    const issueWidget = this.node.closest('.issue-widget');\n    if (issueWidget) {\n      const category = issueWidget.closest('.category');\n      issueWidget.remove();\n      if (category && !category.querySelector('.issue-widget')) {\n        category.remove();\n      }\n    }\n\n    // For all fixes, highlight the current cell\n    this.cell.node.style.transition = 'background-color 0.5s ease';\n    this.cell.node.style.backgroundColor = 'var(--success-green)';\n    setTimeout(() => {\n      this.cell.node.style.backgroundColor = '';\n    }, 1000);\n  }\n\n  // Re-run content-based detectors for this cell only and dispatch an update\n  protected async reanalyzeCellAndDispatch(): Promise<void> {\n    const notebookPanel = this.cell.parent?.parent as NotebookPanel;\n    if (!notebookPanel) {\n      return;\n    }\n    // Find cell index within the notebook (TODO: Include cellIndex at the first place)\n    const cellIndex =\n      (this.cell as any).parent?.widgets.indexOf(this.cell) ?? -1;\n    if (cellIndex < 0) {\n      return;\n    }\n\n    setTimeout(async () => {\n      const accessibleCells = notebookToGeneralCells(notebookPanel);\n      const targetCell = accessibleCells[cellIndex];\n      const issues = await analyzeCellIssues(\n        targetCell,\n        document,\n        PageConfig.getBaseUrl(),\n        new BrowserImageProcessor(),\n        notebookPanel.context.path\n      );\n      const event = new CustomEvent('notebookReanalyzed', {\n        detail: { issues, isCellUpdate: true },\n        bubbles: true,\n        composed: true\n      } as any);\n      // Dispatch from this widget's node so it bubbles up to the main panel\n      //this.node.dispatchEvent(event);\n      // Also dispatch directly on the main panel root for robustness\n      const mainPanelEl = document.getElementById('a11y-sidebar');\n      if (mainPanelEl) {\n        mainPanelEl.dispatchEvent(event);\n      }\n    }, 100);\n  }\n\n  // Generic notebook reanalysis hook. By default, just reanalyze this cell.\n  // Widgets with notebook-wide effects (e.g., headings) should override.\n  protected async reanalyzeNotebookAndDispatch(): Promise<void> {\n    await this.reanalyzeCellAndDispatch();\n  }\n}\n\nexport abstract class ButtonFixWidget extends FixWidget {\n  protected applyButton: HTMLButtonElement;\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n\n    this.node.innerHTML = `\n      <div class=\"fix-description\">${this.getDescription()}</div>\n      <div class=\"button-container\">\n        <button class=\"jp-Button2 button-fix-button\">\n          <span class=\"material-icons\">check</span>\n          <div>${this.getApplyButtonText()}</div>\n        </button>\n      </div>\n    `;\n\n    this.applyButton = this.node.querySelector(\n      '.button-fix-button'\n    ) as HTMLButtonElement;\n    this.applyButton.addEventListener('click', () => this.applyFix());\n  }\n\n  protected abstract getApplyButtonText(): string;\n  protected abstract applyFix(): void;\n}\n\nexport abstract class TextFieldFixWidget extends FixWidget {\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n\n    // Simplified DOM structure\n    this.node.innerHTML = `\n        <div class=\"fix-description\">${this.getDescription()}</div>\n        <div class=\"textfield-fix-widget\">\n          <input type=\"text\" class=\"jp-a11y-input\" placeholder=\"Input text here...\">\n          <div class=\"textfield-buttons\">\n              <button class=\"jp-Button2 suggest-button\">\n                  <span class=\"material-icons\">auto_awesome</span>\n                  <div>Get AI Suggestions</div>\n              </button>\n              <button class=\"jp-Button2 apply-button\">\n                  <span class=\"material-icons\">check</span>\n                  <div>Apply</div>\n              </button>\n          </div>\n        </div>\n      `;\n\n    // Apply Button\n    const applyButton = this.node.querySelector(\n      '.apply-button'\n    ) as HTMLButtonElement;\n\n    if (applyButton) {\n      applyButton.addEventListener('click', () => {\n        const textInput = this.node.querySelector(\n          '.jp-a11y-input'\n        ) as HTMLInputElement;\n        this.applyTextToCell(textInput.value.trim());\n      });\n    }\n\n    // Suggest Button\n    const suggestButton = this.node.querySelector(\n      '.suggest-button'\n    ) as HTMLButtonElement;\n\n    suggestButton.style.display = aiEnabled ? 'flex' : 'none';\n\n    suggestButton.addEventListener('click', () => this.displayAISuggestions());\n\n    // Textfield Value\n    const textFieldValue = this.node.querySelector(\n      '.jp-a11y-input'\n    ) as HTMLInputElement;\n\n    if (this.issue.suggestedFix) {\n      textFieldValue.value = this.issue.suggestedFix;\n    }\n  }\n\n  abstract applyTextToCell(providedText: string): void;\n\n  abstract displayAISuggestions(): Promise<void>;\n}\n\nexport abstract class DropdownFixWidget extends FixWidget {\n  protected dropdownButton: HTMLButtonElement;\n  protected dropdownContent: HTMLDivElement;\n  protected dropdownText: HTMLSpanElement;\n  protected applyButton: HTMLButtonElement;\n  protected selectedOption: string = '';\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n\n    // Simplified DOM structure with customizable text\n    this.node.innerHTML = `\n      <div class=\"fix-description\">${this.getDescription()}</div>\n      <div class=\"dropdown-fix-widget\">\n        <div class=\"custom-dropdown\">\n          <button class=\"dropdown-button\">\n            <span class=\"dropdown-text\"></span>\n            <svg class=\"dropdown-arrow\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\n              <path fill=\"currentColor\" d=\"M7 10l5 5 5-5z\"/>\n            </svg>\n          </button>\n          <div class=\"dropdown-content hidden\">\n          </div>\n        </div>\n        <button class=\"jp-Button2 apply-button\" style=\"${this.shouldShowApplyButton() ? '' : 'display: none;'}\">\n          <span class=\"material-icons\">check</span>\n          <div>Apply</div>\n        </button>\n      </div>\n    `;\n\n    this.dropdownButton = this.node.querySelector(\n      '.dropdown-button'\n    ) as HTMLButtonElement;\n    this.dropdownContent = this.node.querySelector(\n      '.dropdown-content'\n    ) as HTMLDivElement;\n    this.dropdownText = this.node.querySelector(\n      '.dropdown-text'\n    ) as HTMLSpanElement;\n    this.applyButton = this.node.querySelector(\n      '.apply-button'\n    ) as HTMLButtonElement;\n\n    // Set initial text\n    if (this.dropdownText) {\n      this.dropdownText.textContent = this.getDefaultDropdownText();\n    }\n\n    // Populate dropdown options\n    if (this.dropdownContent) {\n      this.dropdownContent.innerHTML = this.getDropdownOptions();\n    }\n\n    // Setup dropdown handlers\n    this.setupDropdownHandlers();\n  }\n\n  protected setupDropdownHandlers(): void {\n    // Toggle dropdown\n    this.dropdownButton.addEventListener('click', e => {\n      e.stopPropagation(); // Prevent event from bubbling up\n      this.dropdownContent.classList.toggle('hidden');\n      this.dropdownButton.classList.toggle('active');\n    });\n\n    // Close dropdown when clicking outside\n    document.addEventListener('click', event => {\n      if (!this.node.contains(event.target as Node)) {\n        this.dropdownContent.classList.add('hidden');\n        this.dropdownButton.classList.remove('active');\n      }\n    });\n\n    // Option selection\n    const options = this.dropdownContent.querySelectorAll('.dropdown-option');\n    options.forEach(option => {\n      option.addEventListener('click', e => {\n        e.stopPropagation(); // Prevent event from bubbling up\n        const value = (option as HTMLDivElement).dataset.value || '';\n        this.selectedOption = value;\n        this.handleOptionSelect(value);\n        this.dropdownText.textContent =\n          (option as HTMLDivElement).textContent?.trim() || '';\n        this.dropdownContent.classList.add('hidden');\n        this.dropdownButton.classList.remove('active');\n        if (this.shouldShowApplyButton()) {\n          this.applyButton.style.display = 'flex';\n        }\n      });\n    });\n\n    // Apply button\n    this.applyButton.addEventListener('click', () => {\n      if (this.selectedOption) {\n        this.applyDropdownSelection(this.selectedOption);\n      }\n    });\n  }\n\n  // Abstract methods that must be implemented by child classes\n  protected abstract getDefaultDropdownText(): string;\n  protected abstract getDropdownOptions(): string;\n  protected abstract shouldShowApplyButton(): boolean;\n  protected abstract handleOptionSelect(value: string): void;\n  abstract applyDropdownSelection(selectedValue: string): void;\n}\n","// In src/components/fix/buttonFixes.ts\n\nimport { ButtonFixWidget } from './base.js';\nimport {\n  replaceSlice,\n  getIssueOffsets\n} from '@berkeley-dsep-infra/a11y-checker-core';\n\nexport class TableScopeFixWidget extends ButtonFixWidget {\n  protected getDescription(): string {\n    return 'Add scope attributes to all table headers:';\n  }\n\n  protected getApplyButtonText(): string {\n    return 'Apply Scope Fixes';\n  }\n\n  protected async applyFix(): Promise<void> {\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n\n    //console.log('Processing table for scope fix:', target);\n\n    // Process the table\n    const processTable = (tableHtml: string): string => {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(tableHtml, 'text/html');\n      const table = doc.querySelector('table');\n\n      if (!table) {\n        return tableHtml;\n      }\n\n      // Get all rows, handling both direct tr children and tr children of tbody\n      const rows = Array.from(table.querySelectorAll('tr'));\n      //console.log('Found rows:', rows.length);\n\n      if (rows.length === 0) {\n        //console.log('No rows found in table');\n        return tableHtml;\n      }\n\n      // Create new table structure\n      const newTable = doc.createElement('table');\n\n      // Copy all attributes from original table\n      Array.from(table.attributes).forEach(attr => {\n        newTable.setAttribute(attr.name, attr.value);\n      });\n\n      // Copy caption if it exists\n      const existingCaption = table.querySelector('caption');\n      if (existingCaption) {\n        //console.log('Found existing caption:', existingCaption.textContent);\n        newTable.appendChild(existingCaption.cloneNode(true));\n      }\n\n      // Process header row\n      const headerRow = rows[0];\n      const headerCells = headerRow.querySelectorAll('th, td');\n      //console.log('Header cells found:', headerCells.length);\n\n      if (headerCells.length > 0) {\n        const thead = doc.createElement('thead');\n        const newHeaderRow = doc.createElement('tr');\n\n        headerCells.forEach(cell => {\n          // Convert td to th if it's in the header row\n          const newCell = doc.createElement('th');\n          newCell.innerHTML = cell.innerHTML;\n          newCell.setAttribute('scope', 'col');\n          newHeaderRow.appendChild(newCell);\n        });\n\n        thead.appendChild(newHeaderRow);\n        newTable.appendChild(thead);\n      }\n\n      // Process remaining rows\n      const tbody = doc.createElement('tbody');\n      rows.slice(1).forEach(row => {\n        const newRow = doc.createElement('tr');\n        const cells = row.querySelectorAll('td, th');\n\n        cells.forEach((cell, index) => {\n          const newCell = cell.cloneNode(true) as HTMLTableCellElement;\n          if (cell.tagName.toLowerCase() === 'th') {\n            newCell.setAttribute('scope', 'row');\n          }\n          newRow.appendChild(newCell);\n        });\n\n        tbody.appendChild(newRow);\n      });\n\n      newTable.appendChild(tbody);\n\n      // Format the table HTML with proper indentation\n      const formatTable = (table: HTMLElement): string => {\n        const indent = '  '; // 2 spaces for indentation\n        let result = '<table';\n\n        // Add attributes\n        Array.from(table.attributes).forEach(attr => {\n          result += ` ${attr.name}=\"${attr.value}\"`;\n        });\n        result += '>\\n';\n\n        // Add caption if it exists\n        const caption = table.querySelector('caption');\n        if (caption) {\n          result += `${indent}<caption>${caption.textContent}</caption>\\n`;\n        }\n\n        // Add thead if it exists\n        const thead = table.querySelector('thead');\n        if (thead) {\n          result += `${indent}<thead>\\n`;\n          const headerRow = thead.querySelector('tr');\n          if (headerRow) {\n            result += `${indent}${indent}<tr>\\n`;\n            Array.from(headerRow.children).forEach(cell => {\n              result += `${indent}${indent}${indent}${cell.outerHTML}\\n`;\n            });\n            result += `${indent}${indent}</tr>\\n`;\n          }\n          result += `${indent}</thead>\\n`;\n        }\n\n        // Add tbody\n        const tbody = table.querySelector('tbody');\n        if (tbody) {\n          result += `${indent}<tbody>\\n`;\n          Array.from(tbody.children).forEach(row => {\n            result += `${indent}${indent}<tr>\\n`;\n            Array.from(row.children).forEach(cell => {\n              result += `${indent}${indent}${indent}${cell.outerHTML}\\n`;\n            });\n            result += `${indent}${indent}</tr>\\n`;\n          });\n          result += `${indent}</tbody>\\n`;\n        }\n\n        result += '</table>';\n        return result;\n      };\n\n      const result = formatTable(newTable);\n      return result;\n    };\n\n    // Prefer precise slice replacement using detector-provided offsets\n    const offsets = getIssueOffsets(this.issue, entireCellContent.length);\n    if (offsets) {\n      const { offsetStart, offsetEnd } = offsets;\n      const originalSlice = entireCellContent.slice(offsetStart, offsetEnd);\n      const replacedSlice = processTable(originalSlice);\n      const newContent = replaceSlice(\n        entireCellContent,\n        offsetStart,\n        offsetEnd,\n        replacedSlice\n      );\n      this.cell.model.sharedModel.setSource(newContent);\n    } else {\n      // Fallback: find and replace first table occurrence\n      const tableRegex = /<table[^>]*>[\\s\\S]*?<\\/table>/;\n      const match = entireCellContent.match(tableRegex);\n      if (match) {\n        const newContent = entireCellContent.replace(\n          match[0],\n          processTable(match[0])\n        );\n        this.cell.model.sharedModel.setSource(newContent);\n      }\n    }\n\n    await this.reanalyzeCellAndDispatch();\n\n    this.removeIssueWidget();\n  }\n}\n","import {\n  replaceSlice,\n  analyzeTableIssues,\n  analyzeHeadingHierarchy,\n  detectHeadingOneIssue,\n  ICellIssue,\n  getIssueOffsets\n} from '@berkeley-dsep-infra/a11y-checker-core';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { Cell, ICellModel } from '@jupyterlab/cells';\nimport { DropdownFixWidget } from './base.js';\nimport { notebookToGeneralCells } from '../../adapter.js';\n\nexport class TableHeaderFixWidget extends DropdownFixWidget {\n  protected getDescription(): string {\n    return 'Choose which row or column should be used as the header:';\n  }\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n  }\n\n  protected getDefaultDropdownText(): string {\n    return 'Select header type';\n  }\n\n  protected getDropdownOptions(): string {\n    return `\n        <div class=\"dropdown-option\" data-value=\"first-row\">\n          The first row is a header\n        </div>\n        <div class=\"dropdown-option\" data-value=\"first-column\">\n          The first column is a header\n        </div>\n        <div class=\"dropdown-option\" data-value=\"both\">\n          The first row and column are headers\n        </div>\n      `;\n  }\n\n  protected shouldShowApplyButton(): boolean {\n    return true;\n  }\n\n  protected handleOptionSelect(value: string): void {\n    this.dropdownText.textContent =\n      this.dropdownContent\n        .querySelector(`[data-value=\"${value}\"]`)\n        ?.textContent?.trim() || 'Select header type';\n  }\n\n  applyDropdownSelection(headerType: string): void {\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n    const target = this.issue.issueContentRaw;\n\n    const convertToHeaderCell = (cell: string): string => {\n      // Remove any existing th tags if present\n      cell = cell.replace(/<\\/?th[^>]*>/g, '');\n      // Remove td tags if present\n      cell = cell.replace(/<\\/?td[^>]*>/g, '');\n      // Wrap with th tags\n      return `<th>${cell.trim()}</th>`;\n    };\n\n    const processTable = (tableHtml: string): string => {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(tableHtml, 'text/html');\n      const table = doc.querySelector('table');\n\n      if (!table) {\n        return tableHtml;\n      }\n\n      // Get all rows, filtering out empty ones\n      const rows = Array.from(table.querySelectorAll('tr')).filter(\n        row => row.querySelectorAll('td, th').length > 0\n      );\n\n      if (rows.length === 0) {\n        return tableHtml;\n      }\n\n      switch (headerType) {\n        case 'first-row': {\n          // Convert first row cells to headers\n          const firstRow = rows[0];\n          const cells = Array.from(firstRow.querySelectorAll('td, th'));\n          cells.forEach(cell => {\n            const newHeader = convertToHeaderCell(cell.innerHTML);\n            cell.outerHTML = newHeader;\n          });\n          break;\n        }\n        case 'first-column': {\n          // Convert first column cells to headers\n          rows.forEach(row => {\n            const firstCell = row.querySelector('td, th');\n            if (firstCell) {\n              const newHeader = convertToHeaderCell(firstCell.innerHTML);\n              firstCell.outerHTML = newHeader;\n            }\n          });\n          break;\n        }\n        case 'both': {\n          // Convert both first row and first column\n          rows.forEach((row, rowIndex) => {\n            const cells = Array.from(row.querySelectorAll('td, th'));\n            cells.forEach((cell, cellIndex) => {\n              if (rowIndex === 0 || cellIndex === 0) {\n                const newHeader = convertToHeaderCell(cell.innerHTML);\n                cell.outerHTML = newHeader;\n              }\n            });\n          });\n          break;\n        }\n      }\n\n      return table.outerHTML;\n    };\n\n    const newContent = entireCellContent.replace(target, processTable(target));\n    this.cell.model.sharedModel.setSource(newContent);\n    this.removeIssueWidget();\n\n    // Wait a short delay for the cell to update\n    setTimeout(async () => {\n      if (this.cell.parent?.parent) {\n        try {\n          // Only analyze table issues\n          const accessibleCells = notebookToGeneralCells(\n            this.cell.parent.parent as NotebookPanel\n          );\n          const tableIssues = await analyzeTableIssues(accessibleCells);\n\n          // Find the main panel widget\n          const mainPanel = document\n            .querySelector('.a11y-panel')\n            ?.closest('.lm-Widget');\n          if (mainPanel) {\n            // Dispatch a custom event with just table issues\n            const event = new CustomEvent('notebookReanalyzed', {\n              detail: {\n                issues: tableIssues,\n                isTableUpdate: true\n              },\n              bubbles: true\n            });\n            mainPanel.dispatchEvent(event);\n          }\n        } catch (error) {\n          console.error('Error reanalyzing notebook:', error);\n        }\n      }\n    }, 100); // Small delay to ensure cell content is updated\n  }\n}\n\nexport class HeadingOrderFixWidget extends DropdownFixWidget {\n  protected getDescription(): string {\n    return 'Choose from one of the following heading styles instead:';\n  }\n\n  private _currentLevel: number = 1; // Initialize with default value\n  private previousLevel: number | undefined;\n  protected selectedLevel: number | undefined;\n  // private notebookPanel: NotebookPanel;\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n\n    // Get reference to notebook panel\n    // Keep reference in case other methods require it; not used in reanalysis anymore\n    // this.notebookPanel = cell.parent?.parent as NotebookPanel;\n\n    // Parse and set the current level immediately\n    this._currentLevel = HeadingOrderFixWidget.parseHeadingLevel(\n      issue.issueContentRaw\n    );\n\n    // Initialize values after super\n    this.initializeValues(issue);\n\n    // Setup apply button handler\n    if (this.applyButton) {\n      this.applyButton.addEventListener('click', async () => {\n        if (this.selectedLevel) {\n          this.applyDropdownSelection(`h${this.selectedLevel}`);\n          await this.reanalyzeNotebookAndDispatch();\n        }\n      });\n    }\n  }\n\n  protected shouldShowApplyButton(): boolean {\n    return true;\n  }\n\n  protected getDefaultDropdownText(): string {\n    return `Current: h${this._currentLevel}`;\n  }\n\n  protected getDropdownOptions(): string {\n    return ''; // Options are set in constructor after initialization\n  }\n\n  protected handleOptionSelect(value: string): void {\n    const level = parseInt(value.replace('h', ''));\n    this.selectedLevel = level;\n    this.dropdownText.textContent = `Change to h${level}`;\n\n    // Hide the dropdown content\n    if (this.dropdownContent) {\n      this.dropdownContent.classList.add('hidden');\n      this.dropdownButton.classList.remove('active');\n    }\n\n    // Show the apply button\n    if (this.applyButton) {\n      this.applyButton.style.display = 'flex';\n    }\n  }\n\n  applyDropdownSelection(selectedValue: string): void {\n    if (!this.selectedLevel) {\n      return;\n    }\n\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n    const target = this.issue.issueContentRaw;\n    let newContent = entireCellContent;\n\n    const offsets = getIssueOffsets(this.issue, entireCellContent.length);\n    if (offsets) {\n      const { offsetStart, offsetEnd } = offsets;\n      const originalSlice = entireCellContent.slice(offsetStart, offsetEnd);\n\n      let replacedSlice = originalSlice;\n      // Markdown heading: starts with hashes (allow missing or multiple spaces)\n      const mdMatch = originalSlice.match(/^(#{1,6})[ \\t]*(.*)$/m);\n      if (mdMatch) {\n        const headingText = (mdMatch[2] || '').trim();\n        const trailingNewline = originalSlice.endsWith('\\n') ? '\\n' : '';\n        replacedSlice = `${'#'.repeat(this.selectedLevel)} ${headingText}${trailingNewline}`;\n      } else {\n        // HTML heading\n        const inner =\n          originalSlice.match(/<h\\d[^>]*>([\\s\\S]*?)<\\/h\\d>/i)?.[1] || '';\n        replacedSlice = `<h${this.selectedLevel}>${inner}</h${this.selectedLevel}>`;\n      }\n\n      newContent = replaceSlice(\n        entireCellContent,\n        offsetStart,\n        offsetEnd,\n        replacedSlice\n      );\n    } else {\n      // Fallback: use previous behavior on entire cell\n      if (entireCellContent.trim().startsWith('#')) {\n        const currentLevelMatch = entireCellContent.match(/^(#+)[ \\t]*/);\n        if (currentLevelMatch) {\n          const currentMarkers = currentLevelMatch[1];\n          newContent = entireCellContent.replace(\n            new RegExp(`^${currentMarkers}[ \\\\t]*(.*)$`, 'm'),\n            `${'#'.repeat(this.selectedLevel)} $1`\n          );\n        }\n      } else if (target.match(/<h\\d[^>]*>/)) {\n        newContent = entireCellContent.replace(\n          target,\n          `<h${this.selectedLevel}>${target.match(/<h\\d[^>]*>([\\s\\S]*?)<\\/h\\d>/)?.[1] || ''}</h${this.selectedLevel}>`\n        );\n      }\n    }\n\n    if (newContent !== entireCellContent) {\n      this.cell.model.sharedModel.setSource(newContent);\n      this.removeIssueWidget();\n    }\n  }\n\n  private initializeValues(issue: ICellIssue): void {\n    // Get previous level from metadata\n    this.previousLevel = issue.metadata?.previousHeadingLevel;\n\n    // If metadata doesn't have previous level, try to find the closest previous heading\n    if (this.previousLevel === undefined) {\n      this.previousLevel = this.findClosestPreviousHeading(issue.cellIndex);\n    }\n\n    // Update the dropdown text explicitly after initialization\n    if (this.dropdownText) {\n      this.dropdownText.textContent = this.getDefaultDropdownText();\n    }\n\n    // Force update dropdown content after initialization\n    if (this.dropdownContent) {\n      const validLevels = this.getValidHeadingLevels();\n      this.dropdownContent.innerHTML = Array.from(validLevels)\n        .sort((a, b) => a - b)\n        .map(\n          level => `\n            <div class=\"dropdown-option\" data-value=\"h${level}\">\n              Change to h${level}\n            </div>\n          `\n        )\n        .join('');\n\n      // Add click handlers to the options\n      const options = this.dropdownContent.querySelectorAll('.dropdown-option');\n      options.forEach(option => {\n        option.addEventListener('click', e => {\n          e.stopPropagation();\n          const value = (option as HTMLElement).dataset.value;\n          if (value) {\n            this.handleOptionSelect(value);\n          }\n        });\n      });\n    }\n  }\n\n  // Static helper method to parse heading level\n  private static parseHeadingLevel(rawContent: string): number {\n    // Try HTML heading pattern first\n    const htmlMatch = rawContent.match(/<h([1-6])[^>]*>/i);\n    if (htmlMatch) {\n      const level = parseInt(htmlMatch[1]);\n      return level;\n    }\n\n    // Try Markdown heading pattern - match # followed by space\n    const mdMatch = rawContent.match(/^(#{1,6})\\s+/m);\n    if (mdMatch) {\n      const level = mdMatch[1].length;\n      return level;\n    }\n\n    return 1; // Default level\n  }\n\n  private findClosestPreviousHeading(cellIndex: number): number | undefined {\n    const notebook = this.cell.parent;\n    if (!notebook) {\n      return undefined;\n    }\n\n    // Start from the cell before the current one and go backwards\n    for (let i = cellIndex - 1; i >= 0; i--) {\n      const prevCell = (notebook as any).widgets[i];\n      if (!prevCell || prevCell.model.type !== 'markdown') {\n        continue;\n      }\n\n      const content = prevCell.model.sharedModel.getSource();\n      // Check for markdown heading (# syntax)\n      const mdMatch = content.match(/^(#{1,6})\\s+/m);\n      if (mdMatch) {\n        return mdMatch[1].length;\n      }\n      // Check for HTML heading\n      const htmlMatch = content.match(/<h([1-6])[^>]*>/i);\n      if (htmlMatch) {\n        return parseInt(htmlMatch[1]);\n      }\n    }\n    return undefined;\n  }\n\n  private getValidHeadingLevels(): Set<number> {\n    const validLevels = new Set<number>();\n\n    // Always add h2 as a valid option\n    validLevels.add(2);\n\n    if (this.previousLevel !== undefined) {\n      // Special case: if previous heading is h1, current heading must be h2\n      if (this.previousLevel === 1) {\n        return validLevels;\n      }\n\n      // Can stay at the same level as the previous heading (but not if it's the current level)\n      if (this.previousLevel !== this._currentLevel) {\n        validLevels.add(this.previousLevel);\n      }\n\n      // Can go exactly one level deeper than the previous heading (but not if it's the current level)\n      if (this.previousLevel < 6) {\n        const nextLevel = this.previousLevel + 1;\n        if (nextLevel !== this._currentLevel) {\n          validLevels.add(nextLevel);\n        }\n      }\n\n      // Can go exactly one level higher than the previous heading (but not if it's the current level)\n      if (this.previousLevel > 1) {\n        const prevLevel = this.previousLevel - 1;\n        if (prevLevel !== this._currentLevel && prevLevel > 1) {\n          // Also ensure we never include h1\n          validLevels.add(prevLevel);\n        }\n      }\n    }\n\n    return validLevels;\n  }\n\n  // Override notebook reanalysis to run heading-wide checks\n  protected async reanalyzeNotebookAndDispatch(): Promise<void> {\n    const notebookPanel = this.cell.parent?.parent as NotebookPanel;\n    if (!notebookPanel) {\n      return;\n    }\n    setTimeout(async () => {\n      const accessibleCells = notebookToGeneralCells(notebookPanel);\n      const headingHierarchyIssues =\n        await analyzeHeadingHierarchy(accessibleCells);\n      const headingOneIssues = await detectHeadingOneIssue(\n        '',\n        0,\n        'markdown',\n        accessibleCells\n      );\n      const allHeadingIssues = [...headingHierarchyIssues, ...headingOneIssues];\n      const mainPanel = document\n        .querySelector('.a11y-panel')\n        ?.closest('.lm-Widget');\n      if (mainPanel) {\n        const event = new CustomEvent('notebookReanalyzed', {\n          detail: {\n            issues: allHeadingIssues,\n            isHeadingUpdate: true\n          },\n          bubbles: true\n        });\n        mainPanel.dispatchEvent(event);\n      }\n    }, 100);\n  }\n}\n","\nimport {\n  ICellIssue,\n  getIssueOffsets,\n  replaceSlice,\n  getImageAltSuggestion,\n  getTableCaptionSuggestion,\n  IModelSettings\n} from '@berkeley-dsep-infra/a11y-checker-core';\n\nimport { Cell, ICellModel } from '@jupyterlab/cells';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { TextFieldFixWidget } from './base.js';\n\nexport class ImageAltFixWidget extends TextFieldFixWidget {\n  private visionSettings: IModelSettings;\n\n  protected getDescription(): string {\n    return 'Add or update alt text for the image:';\n  }\n\n  constructor(\n    issue: ICellIssue,\n    cell: Cell<ICellModel>,\n    aiEnabled: boolean,\n    visionSettings: IModelSettings\n  ) {\n    super(issue, cell, aiEnabled);\n    this.visionSettings = visionSettings;\n  }\n\n  async applyTextToCell(providedAltText: string): Promise<void> {\n    if (providedAltText === '') {\n      return;\n    }\n\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n    const target = this.issue.issueContentRaw;\n\n    // Try to parse deterministic offsets from metadata.issueId (format: cell-{idx}-image-missing-alt-o{start}-{end})\n    const offsets = getIssueOffsets(this.issue, entireCellContent.length);\n    const offsetStart: number | null = offsets?.offsetStart ?? null;\n    const offsetEnd: number | null = offsets?.offsetEnd ?? null;\n\n    // Offsets are already validated in getIssueOffsets\n\n    // Handle HTML image tags\n    const handleHtmlImage = (imageText: string): string => {\n      // Alt attribute exists but is empty\n      if (imageText.includes('alt=\"\"') || imageText.includes(\"alt=''\")) {\n        return imageText.replace(/alt=[\"']\\s*[\"']/, `alt = \"${providedAltText}\"`);\n      }\n      // Alt attribute does not exist\n      return imageText.replace(/\\s*\\/?>(?=$)/, ` alt = \"${providedAltText}\"$ & `);\n    };\n\n    // Handle markdown images\n    const handleMarkdownImage = (imageText: string): string => {\n      return imageText.replace(/!\\[\\]/, `![${providedAltText}]`);\n    };\n\n    let newContent = entireCellContent;\n\n    if (offsetStart !== null && offsetEnd !== null) {\n      const originalSlice = entireCellContent.slice(offsetStart, offsetEnd);\n      let replacedSlice = originalSlice;\n      if (originalSlice.startsWith('<img')) {\n        replacedSlice = handleHtmlImage(originalSlice);\n      } else if (originalSlice.startsWith('![')) {\n        replacedSlice = handleMarkdownImage(originalSlice);\n      }\n      newContent = replaceSlice(\n        entireCellContent,\n        offsetStart,\n        offsetEnd,\n        replacedSlice\n      );\n    } else {\n      // Fallback to previous behavior using the captured target\n      if (target.startsWith('<img')) {\n        newContent = entireCellContent.replace(target, handleHtmlImage(target));\n      } else if (target.startsWith('![')) {\n        newContent = entireCellContent.replace(\n          target,\n          handleMarkdownImage(target)\n        );\n      }\n    }\n\n    this.cell.model.sharedModel.setSource(newContent);\n\n    // Remove the issue widget\n    this.removeIssueWidget();\n\n    await this.reanalyzeCellAndDispatch();\n  }\n\n  async displayAISuggestions(): Promise<void> {\n    const altTextInput = this.node.querySelector(\n      '.jp-a11y-input'\n    ) as HTMLInputElement;\n    if (!altTextInput) {\n      return;\n    }\n\n    // Save the original placeholder text\n    const originalPlaceholder = altTextInput.placeholder;\n\n    // Create loading overlay (so we can see the loading state)\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = `\n        <span class=\"material-icons loading\">refresh</span>\n        Getting AI suggestions...\n`;\n\n    // Add relative positioning to input container and append loading overlay\n    const inputContainer = altTextInput.parentElement;\n    if (inputContainer) {\n      inputContainer.style.position = 'relative';\n      inputContainer.appendChild(loadingOverlay);\n    }\n\n    // Show loading state in the input\n    altTextInput.disabled = true;\n    altTextInput.style.color = 'transparent'; // Hide input text while loading\n    altTextInput.placeholder = ''; // Clear placeholder while showing loading overlay\n\n    try {\n      const suggestion = await getImageAltSuggestion(\n        this.issue,\n        this.cell.node.querySelector('img')?.src || '',\n        this.visionSettings\n      );\n      if (suggestion !== 'Error') {\n        // Extract alt text from the suggestion, handling both single and double quotes\n        const altMatch = suggestion.match(/alt=['\"]([^'\"]*)['\"]/);\n        if (altMatch && altMatch[1]) {\n          altTextInput.value = altMatch[1];\n        } else {\n          altTextInput.value = suggestion; // Fallback to full suggestion if no alt text found\n        }\n      } else {\n        altTextInput.placeholder =\n          'Error getting suggestions. Please try again.';\n      }\n    } catch (error) {\n      console.error(error);\n      altTextInput.placeholder = 'Error getting suggestions. Please try again.';\n    } finally {\n      altTextInput.disabled = false;\n      altTextInput.style.color = ''; // Restore text color\n      loadingOverlay.remove(); // Remove loading overlay\n      if (altTextInput.value) {\n        altTextInput.placeholder = originalPlaceholder;\n      }\n    }\n  }\n}\n\nexport class TableCaptionFixWidget extends TextFieldFixWidget {\n  private languageSettings: IModelSettings;\n\n  protected getDescription(): string {\n    return 'Add or update the caption for the table:';\n  }\n\n  constructor(\n    issue: ICellIssue,\n    cell: Cell<ICellModel>,\n    aiEnabled: boolean,\n    languageSettings: IModelSettings\n  ) {\n    super(issue, cell, aiEnabled);\n    this.languageSettings = languageSettings;\n  }\n\n  async applyTextToCell(providedCaption: string): Promise<void> {\n    if (providedCaption === '') {\n      return;\n    }\n\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n    const target = this.issue.issueContentRaw;\n\n    const handleHtmlTable = (tableHtml: string): string => {\n      // Check if table already has a caption\n      if (tableHtml.includes('<caption>')) {\n        return tableHtml.replace(\n          /<caption>.*?<\\/caption>/,\n          `< caption > ${providedCaption} </caption>`\n        );\n      } else {\n        return tableHtml.replace(\n          /<table[^>]*>/,\n          `$&\\n  <caption>${providedCaption}</caption>`\n        );\n      }\n    };\n\n    let newContent = entireCellContent;\n\n    if (target.includes('<table')) {\n      const offsets = getIssueOffsets(this.issue, entireCellContent.length);\n      if (offsets) {\n        const { offsetStart, offsetEnd } = offsets;\n        const originalSlice = entireCellContent.slice(offsetStart, offsetEnd);\n        const replacedSlice = handleHtmlTable(originalSlice);\n        newContent = replaceSlice(\n          entireCellContent,\n          offsetStart,\n          offsetEnd,\n          replacedSlice\n        );\n      } else {\n        // Fallback to previous behavior\n        newContent = entireCellContent.replace(target, handleHtmlTable(target));\n      }\n    }\n\n    this.cell.model.sharedModel.setSource(newContent);\n\n    // Remove the issue widget\n    this.removeIssueWidget();\n\n    await this.reanalyzeCellAndDispatch();\n  }\n\n  async displayAISuggestions(): Promise<void> {\n    const captionInput = this.node.querySelector(\n      '.jp-a11y-input'\n    ) as HTMLInputElement;\n    if (!captionInput) {\n      return;\n    }\n\n    // Save the original placeholder text\n    const originalPlaceholder = captionInput.placeholder;\n\n    // Create loading overlay\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = `\n            <span class=\"material-icons loading\">refresh</span>\n            Getting AI suggestions...\n        `;\n\n    // Add relative positioning to input container and append loading overlay\n    const inputContainer = captionInput.parentElement;\n    if (inputContainer) {\n      inputContainer.style.position = 'relative';\n      inputContainer.appendChild(loadingOverlay);\n    }\n\n    // Show loading state in the input\n    captionInput.disabled = true;\n    captionInput.style.color = 'transparent';\n    captionInput.placeholder = '';\n\n    try {\n      const suggestion = await getTableCaptionSuggestion(\n        this.issue,\n        this.languageSettings\n      );\n      if (suggestion !== 'Error') {\n        captionInput.value = suggestion;\n      } else {\n        captionInput.placeholder =\n          'Error getting suggestions. Please try again.';\n      }\n    } catch (error) {\n      console.error(error);\n      captionInput.placeholder = 'Error getting suggestions. Please try again.';\n    } finally {\n      captionInput.disabled = false;\n      captionInput.style.color = '';\n      loadingOverlay.remove();\n      if (captionInput.value) {\n        captionInput.placeholder = originalPlaceholder;\n      }\n    }\n  }\n}\n\nexport class HeadingOneFixWidget extends TextFieldFixWidget {\n  protected getDescription(): string {\n    return 'Add a new level one (h1) heading to the top of the notebook:';\n  }\n\n  constructor(issue: ICellIssue, cell: Cell<ICellModel>, aiEnabled: boolean) {\n    super(issue, cell, aiEnabled);\n\n    const input = this.node.querySelector('.jp-a11y-input') as HTMLInputElement;\n    if (input) {\n      input.placeholder = 'Input h1 heading text...';\n    }\n\n    // Always disable AI suggestion for missing H1 heading\n    const suggestButton = this.node.querySelector(\n      '.suggest-button'\n    ) as HTMLButtonElement;\n    if (suggestButton) {\n      suggestButton.remove();\n    }\n  }\n\n  protected removeIssueWidget(): void {\n    const issueWidget = this.node.closest('.issue-widget');\n    if (issueWidget) {\n      const category = issueWidget.closest('.category');\n      issueWidget.remove();\n      if (category && !category.querySelector('.issue-widget')) {\n        category.remove();\n      }\n    }\n\n    // Highlight the first cell instead of the current cell\n    const notebookPanel = this.cell.parent?.parent as NotebookPanel;\n    if (notebookPanel) {\n      const firstCell = notebookPanel.content.widgets[0];\n      if (firstCell) {\n        firstCell.node.style.transition = 'background-color 0.5s ease';\n        firstCell.node.style.backgroundColor = '#28A745';\n        setTimeout(() => {\n          firstCell.node.style.backgroundColor = '';\n        }, 1000);\n      }\n    }\n  }\n\n  applyTextToCell(providedHeading: string): void {\n    if (providedHeading === '') {\n      return;\n    }\n\n    // Get the notebook panel from the cell's parent hierarchy\n    const notebookPanel = this.cell.parent?.parent as NotebookPanel;\n    if (!notebookPanel) {\n      console.error('Could not find notebook panel');\n      return;\n    }\n\n    // Create a new markdown cell with the h1 heading\n    const newContent = `# ${providedHeading}`;\n\n    // Insert a new cell at the top of the notebook\n    const sharedModel = notebookPanel.content.model?.sharedModel;\n    if (sharedModel) {\n      sharedModel.insertCell(0, {\n        cell_type: 'markdown',\n        source: newContent\n      });\n    }\n\n    // Remove the issue widget\n    this.removeIssueWidget();\n  }\n\n  async displayAISuggestions(): Promise<void> {\n    const headingInput = this.node.querySelector(\n      '.jp-a11y-input'\n    ) as HTMLInputElement;\n    if (!headingInput) {\n      return;\n    }\n\n    // Save the original placeholder text\n    const originalPlaceholder = headingInput.placeholder;\n\n    // Create loading overlay\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = `\n        <span class=\"material-icons loading\">refresh</span>\n        Getting AI suggestions...\n      `;\n\n    // Add relative positioning to input container and append loading overlay\n    const inputContainer = headingInput.parentElement;\n    if (inputContainer) {\n      inputContainer.style.position = 'relative';\n      inputContainer.appendChild(loadingOverlay);\n    }\n\n    // Show loading state in the input\n    headingInput.disabled = true;\n    headingInput.style.color = 'transparent';\n    headingInput.placeholder = '';\n\n    try {\n      // TODO: Implement AI suggestion??? Is it needed?\n      headingInput.value = 'Notebook Title';\n    } catch (error) {\n      console.error(error);\n      headingInput.placeholder = 'Error getting suggestions. Please try again.';\n    } finally {\n      headingInput.disabled = false;\n      headingInput.style.color = '';\n      loadingOverlay.remove();\n      if (headingInput.value) {\n        headingInput.placeholder = originalPlaceholder;\n      }\n    }\n  }\n}\n\nexport class LinkTextFixWidget extends TextFieldFixWidget {\n  protected getDescription(): string {\n    return 'Update the link text or aria-label:';\n  }\n\n  applyTextToCell(providedText: string): void {\n    if (providedText === '') {\n      return;\n    }\n\n    const entireCellContent = this.cell.model.sharedModel.getSource();\n    const offsets = getIssueOffsets(this.issue, entireCellContent.length);\n    const offsetStart: number | null = offsets?.offsetStart ?? null;\n    const offsetEnd: number | null = offsets?.offsetEnd ?? null;\n\n    let newContent = entireCellContent;\n\n    const replaceMarkdownLinkText = (full: string): string => {\n      return full.replace(/\\[[^\\]]*\\]/, `[${providedText}]`);\n    };\n\n    const replaceHtmlLinkTextOrAria = (full: string): string => {\n      if (/aria-label=/.test(full)) {\n        return full.replace(\n          /aria-label=[\"'].*?[\"']/i,\n          `aria-label=\"${providedText}\"`\n        );\n      }\n      // If there is no aria-label and no visible inner text, add aria-label\n      const innerText = (\n        full.replace(/<a\\b[^>]*>/i, '').replace(/<\\/a>/i, '') || ''\n      )\n        .replace(/<[^>]*>/g, '')\n        .trim();\n      if (innerText.length === 0) {\n        return full.replace(\n          /<a\\b([^>]*)>/i,\n          (_m, attrs) => `<a${attrs} aria-label=\"${providedText}\">`\n        );\n      }\n      // Otherwise, replace inner text\n      return full.replace(\n        /(<a\\b[^>]*>)([\\s\\S]*?)(<\\/a>)/i,\n        (_m, pre, _inner, post) => `${pre}${providedText}${post}`\n      );\n    };\n\n    if (offsetStart !== null && offsetEnd !== null) {\n      const originalSlice = entireCellContent.slice(offsetStart, offsetEnd);\n      let replacedSlice = originalSlice;\n      if (originalSlice.trim().startsWith('<a')) {\n        replacedSlice = replaceHtmlLinkTextOrAria(originalSlice);\n      } else if (originalSlice.trim().startsWith('[')) {\n        replacedSlice = replaceMarkdownLinkText(originalSlice);\n      }\n      newContent = replaceSlice(\n        entireCellContent,\n        offsetStart,\n        offsetEnd,\n        replacedSlice\n      );\n    } else {\n      const target = this.issue.issueContentRaw;\n      if (target.trim().startsWith('<a')) {\n        newContent = entireCellContent.replace(\n          target,\n          replaceHtmlLinkTextOrAria(target)\n        );\n      } else if (target.trim().startsWith('[')) {\n        newContent = entireCellContent.replace(\n          target,\n          replaceMarkdownLinkText(target)\n        );\n      }\n    }\n\n    this.cell.model.sharedModel.setSource(newContent);\n    this.removeIssueWidget();\n    void this.reanalyzeCellAndDispatch();\n  }\n\n  async displayAISuggestions(): Promise<void> {\n    // Not implemented for links today\n    return;\n  }\n}\n","import { Widget } from '@lumino/widgets';\nimport { Cell, ICellModel } from '@jupyterlab/cells';\n\nimport {\n  ImageAltFixWidget,\n  TableCaptionFixWidget,\n  TableHeaderFixWidget,\n  HeadingOneFixWidget,\n  HeadingOrderFixWidget,\n  TableScopeFixWidget,\n  LinkTextFixWidget\n} from './fix';\n\nimport { issueToDescription } from '@berkeley-dsep-infra/a11y-checker-core';\n\nimport { ICellIssue } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { MainPanelWidget } from './mainpanelWidget.js';\n\nexport class CellIssueWidget extends Widget {\n  private issue: ICellIssue;\n  private cell: Cell<ICellModel>;\n  private aiEnabled: boolean = false; // TODO: Create a higher order component to handle this\n  private mainPanel: MainPanelWidget;\n\n  constructor(\n    issue: ICellIssue,\n    cell: Cell<ICellModel>,\n    aiEnabled: boolean,\n    mainPanel: MainPanelWidget\n  ) {\n    super();\n    this.issue = issue;\n    this.cell = cell;\n    this.aiEnabled = aiEnabled;\n    this.mainPanel = mainPanel;\n\n    const issueInformation = issueToDescription.get(issue.violationId);\n    if (issue.customDescription) {\n      issueInformation!.description = issue.customDescription;\n    }\n    if (issue.customDetailedDescription) {\n      issueInformation!.detailedDescription = issue.customDetailedDescription;\n    }\n\n    this.addClass('issue-widget');\n    // Tag widget with identifiers so the panel can selectively update\n    this.node.setAttribute('data-cell-index', String(issue.cellIndex));\n    this.node.setAttribute('data-violation-id', issue.violationId);\n    this.node.innerHTML = `\n      <button class=\"issue-header-button\">\n          <h3 class=\"issue-header\"> ${issueInformation?.title || issue.violationId}</h3>\n          <span class=\"chevron material-icons\">expand_more</span>\n      </button>\n      <div class=\"collapsible-content\" style=\"display: none;\">\n          <p class=\"description\">\n              ${issueInformation?.description}\n          </p>\n          <p class=\"detailed-description\" style=\"display: none;\">\n              ${issueInformation?.detailedDescription || ''} (<a href=\"${issueInformation?.descriptionUrl || ''}\" target=\"_blank\">learn more about the issue and its impact</a>).\n          </p>\n          <div class=\"button-container\">\n              <button class=\"jp-Button2 locate-button\">\n                  <span class=\"material-icons\">search</span>\n                  <div>Locate</div>\n              </button>\n              <button class=\"jp-Button2 explain-button\">\n                  <span class=\"material-icons\">question_mark</span>\n                  <div>Learn more</div>\n              </button>\n          </div>\n          <div class=\"offending-content-block\">\n              <div class=\"offending-title\">Original content:</div>\n              <pre class=\"offending-snippet\" style=\"white-space: pre-wrap; max-height: 200px; overflow: auto; background: var(--jp-layout-color2); padding: 8px; border-radius: 4px; border: 1px solid var(--jp-border-color2);\"></pre>\n          </div>\n          <div class=\"fix-widget-container\"></div>\n      </div>\n    `;\n\n    // Add event listeners using query selectors\n    const headerButton = this.node.querySelector('.issue-header-button');\n    const collapsibleContent = this.node.querySelector(\n      '.collapsible-content'\n    ) as HTMLElement;\n\n    // Toggle collapsible content when header is clicked\n    headerButton?.addEventListener('click', () => {\n      if (collapsibleContent) {\n        const isHidden = collapsibleContent.style.display === 'none';\n        collapsibleContent.style.display = isHidden ? 'block' : 'none';\n\n        const expandIcon = this.node.querySelector('.chevron');\n        expandIcon?.classList.toggle('expanded');\n      }\n    });\n\n    const locateButton = this.node.querySelector('.locate-button');\n    locateButton?.addEventListener('click', () => this.navigateToCell());\n\n    const explainButton = this.node.querySelector('.explain-button');\n    const detailedDescription = this.node.querySelector(\n      '.detailed-description'\n    ) as HTMLElement;\n    explainButton?.addEventListener('click', () => {\n      if (detailedDescription) {\n        detailedDescription.style.display =\n          detailedDescription.style.display === 'none' ? 'block' : 'none';\n      }\n    });\n\n    // Populate offending content as plain text (not rendered)\n    const offendingSnippet = this.node.querySelector(\n      '.offending-snippet'\n    ) as HTMLElement;\n    if (offendingSnippet) {\n      offendingSnippet.textContent = `${this.issue.issueContentRaw || ''}`;\n    }\n\n    // Show suggest button initially if AI is enabled\n    const mainPanelElement = document.getElementById(\n      'a11y-sidebar'\n    ) as HTMLElement;\n    if (mainPanelElement) {\n      const aiToggleButton =\n        mainPanelElement.querySelector('.ai-control-button');\n      if (aiToggleButton && aiToggleButton.textContent?.includes('Enabled')) {\n        this.aiEnabled = true;\n      } else {\n        this.aiEnabled = false;\n      }\n    }\n\n    // Dynamically add the TextFieldFixWidget if needed\n    const fixWidgetContainer = this.node.querySelector('.fix-widget-container');\n    if (!fixWidgetContainer) {\n      return;\n    }\n\n    if (this.issue.violationId === 'image-missing-alt') {\n      const textFieldFixWidget = new ImageAltFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled,\n        this.mainPanel.getVisionModelSettings()\n      );\n      fixWidgetContainer.appendChild(textFieldFixWidget.node);\n    } else if (this.issue.violationId === 'table-missing-caption') {\n      const tableCaptionFixWidget = new TableCaptionFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled,\n        this.mainPanel.getLanguageModelSettings()\n      );\n      fixWidgetContainer.appendChild(tableCaptionFixWidget.node);\n    } else if (this.issue.violationId === 'table-missing-header') {\n      const tableHeaderFixWidget = new TableHeaderFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled\n      );\n      fixWidgetContainer.appendChild(tableHeaderFixWidget.node);\n    } else if (this.issue.violationId === 'heading-missing-h1') {\n      const headingOneFixWidget = new HeadingOneFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled\n      );\n      fixWidgetContainer.appendChild(headingOneFixWidget.node);\n    } else if (this.issue.violationId === 'heading-wrong-order') {\n      const headingOrderFixWidget = new HeadingOrderFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled\n      );\n      fixWidgetContainer.appendChild(headingOrderFixWidget.node);\n    } else if (this.issue.violationId === 'table-missing-scope') {\n      const tableScopeFixWidget = new TableScopeFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled\n      );\n      fixWidgetContainer.appendChild(tableScopeFixWidget.node);\n    } else if (this.issue.violationId === 'link-discernible-text') {\n      const linkTextFixWidget = new LinkTextFixWidget(\n        this.issue,\n        this.cell,\n        this.aiEnabled\n      );\n      fixWidgetContainer.appendChild(linkTextFixWidget.node);\n    }\n  }\n\n  private navigateToCell(): void {\n    this.cell.node.scrollIntoView({ behavior: 'auto', block: 'nearest' });\n\n    requestAnimationFrame(() => {\n      this.cell.node.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    });\n\n    this.cell.node.style.transition = 'background-color 0.5s ease';\n    this.cell.node.style.backgroundColor = '#DB3939';\n\n    setTimeout(() => {\n      this.cell.node.style.backgroundColor = '';\n    }, 1000);\n  }\n}\n","import { Widget } from '@lumino/widgets';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { BrowserImageProcessor } from '../image-processor.js';\n\nimport { PageConfig } from '@jupyterlab/coreutils';\n\nimport {\n  ICellIssue,\n  IModelSettings\n} from '@berkeley-dsep-infra/a11y-checker-core';\nimport {\n  issueToCategory,\n  issueCategoryNames,\n  analyzeCellsAccessibility,\n  analyzeTableIssues\n} from '@berkeley-dsep-infra/a11y-checker-core';\n\nimport { CellIssueWidget } from './issueWidget.js';\nimport { notebookToGeneralCells } from '../adapter.js';\n\nexport class MainPanelWidget extends Widget {\n  private aiEnabled: boolean = false;\n  private currentNotebook: NotebookPanel | null = null;\n  private languageModelSettings: IModelSettings;\n  private visionModelSettings: IModelSettings;\n\n  constructor(settingRegistry?: ISettingRegistry) {\n    super();\n\n    // Default settings\n    this.languageModelSettings = {\n      baseUrl: '',\n      apiKey: '',\n      model: ''\n    };\n\n    this.visionModelSettings = {\n      baseUrl: '',\n      apiKey: '',\n      model: ''\n    };\n\n    // Load settings if available\n    if (settingRegistry) {\n      this.loadSettings(settingRegistry);\n    }\n\n    this.addClass('a11y-panel');\n    this.id = 'a11y-sidebar';\n    const accessibilityIcon = new LabIcon({\n      name: 'a11y:accessibility',\n      svgstr:\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"#154F92\" d=\"M256 48c114.953 0 208 93.029 208 208 0 114.953-93.029 208-208 208-114.953 0-208-93.029-208-208 0-114.953 93.029-208 208-208m0-40C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 56C149.961 64 64 149.961 64 256s85.961 192 192 192 192-85.961 192-192S362.039 64 256 64zm0 44c19.882 0 36 16.118 36 36s-16.118 36-36 36-36-16.118-36-36 16.118-36 36-36zm117.741 98.023c-28.712 6.779-55.511 12.748-82.14 15.807.851 101.023 12.306 123.052 25.037 155.621 3.617 9.26-.957 19.698-10.217 23.315-9.261 3.617-19.699-.957-23.316-10.217-8.705-22.308-17.086-40.636-22.261-78.549h-9.686c-5.167 37.851-13.534 56.208-22.262 78.549-3.615 9.255-14.05 13.836-23.315 10.217-9.26-3.617-13.834-14.056-10.217-23.315 12.713-32.541 24.185-54.541 25.037-155.621-26.629-3.058-53.428-9.027-82.141-15.807-8.6-2.031-13.926-10.648-11.895-19.249s10.647-13.926 19.249-11.895c96.686 22.829 124.283 22.783 220.775 0 8.599-2.03 17.218 3.294 19.249 11.895 2.029 8.601-3.297 17.219-11.897 19.249z\"/></svg>'\n    });\n\n    this.title.icon = accessibilityIcon;\n    this.node.innerHTML = `\n      <div class=\"main-container\">\n          <div class=\"notice-container\">\n              <div class=\"notice-header\">\n                  <div class=\"notice-title\">\n                      <span class=\"chevron material-icons\">expand_more</span>\n                      <strong>Notice: Known cell navigation error </strong>\n                  </div>\n                  <button class=\"notice-delete-button\"></button>\n              </div>\n              <div class=\"notice-content hidden\">\n                  <p>\n                      The jupyterlab-a11y-checker has a known cell navigation issue for Jupyterlab version 4.2.5 or later. \n                      To fix this, please navigate to 'Settings'  'Settings Editor'  Notebook, scroll down to 'Windowing mode', \n                      and choose 'defer' from the dropdown. Please note that this option may reduce the performance of the application. \n                      For more information, please see the <a href=\"https://jupyter-notebook.readthedocs.io/en/stable/changelog.html\" target=\"_blank\" style=\"text-decoration: underline;\">Jupyter Notebook changelog.</a>\n                  </p>\n              </div>\n          </div>\n          <h1 class=\"main-title\">Accessibility Checker</h1>\n          <div class=\"controls-container\">\n              <button class=\"control-button ai-control-button\">\n                <span class=\"material-icons\">auto_awesome</span>\n                Use AI : Disabled\n              </button>\n              <button class=\"control-button analyze-control-button\">\n                <span class=\"material-icons\">science</span>  \n                Analyze Notebook\n              </button>\n          </div>\n          <div class=\"issues-container\"></div>\n      </div>\n        `;\n\n    // Notice\n    const noticeContainer = this.node.querySelector('.notice-container');\n    const noticeContent = this.node.querySelector(\n      '.notice-content'\n    ) as HTMLElement;\n    const noticeToggleButton = this.node.querySelector('.notice-title');\n    const noticeDeleteButton = this.node.querySelector('.notice-delete-button');\n    const expandIcon = this.node.querySelector('.chevron');\n\n    noticeToggleButton?.addEventListener('click', () => {\n      noticeContent?.classList.toggle('hidden');\n      expandIcon?.classList.toggle('expanded');\n    });\n\n    noticeDeleteButton?.addEventListener('click', () => {\n      noticeContainer?.classList.add('hidden');\n    });\n\n    // Controls\n    const aiControlButton = this.node.querySelector(\n      '.ai-control-button'\n    ) as HTMLButtonElement;\n    const analyzeControlButton = this.node.querySelector(\n      '.analyze-control-button'\n    ) as HTMLButtonElement;\n    const progressIcon = `\n    <svg class=\"icon loading\" viewBox=\"0 0 24 24\">\n        <path d=\"M12 4V2C6.48 2 2 6.48 2 12h2c0-4.41 3.59-8 8-8z\"/>\n    </svg>\n    `;\n\n    aiControlButton?.addEventListener('click', async () => {\n      const aiIcon = '<span class=\"material-icons\">auto_awesome</span>';\n\n      this.aiEnabled = !this.aiEnabled;\n      aiControlButton.innerHTML = `${aiIcon} Use AI : ${this.aiEnabled ? 'Enabled' : 'Disabled'}`;\n\n      // Update every ai suggestion button visibility\n      const suggestButtons = this.node.querySelectorAll('.suggest-button');\n      suggestButtons.forEach(button => {\n        (button as HTMLElement).style.display = this.aiEnabled\n          ? 'flex'\n          : 'none';\n      });\n    });\n\n    analyzeControlButton?.addEventListener('click', async () => {\n      if (!this.currentNotebook) {\n        console.log('No current notebook found');\n        return;\n      }\n\n      const analyzeControlButtonText = analyzeControlButton.innerHTML;\n\n      const issuesContainer = this.node.querySelector(\n        '.issues-container'\n      ) as HTMLElement;\n      issuesContainer.innerHTML = '';\n      analyzeControlButton.innerHTML = `${progressIcon} Please wait...`;\n      analyzeControlButton.disabled = true;\n\n      try {\n        // Convert widgets to accessible cells\n        const accessibleCells = notebookToGeneralCells(this.currentNotebook);\n\n        // Identify issues\n        const notebookIssues: ICellIssue[] = await analyzeCellsAccessibility(\n          accessibleCells,\n          document,\n          PageConfig.getBaseUrl(),\n          new BrowserImageProcessor(),\n          this.currentNotebook.context.path\n        );\n\n        // Log a human-readable summary for troubleshooting\n        try {\n          const total = notebookIssues.length;\n\n          const byViolation = notebookIssues.reduce(\n            (acc: Record<string, number>, issue) => {\n              acc[issue.violationId] = (acc[issue.violationId] || 0) + 1;\n              return acc;\n            },\n            {} as Record<string, number>\n          );\n          const cellsAffected = Array.from(\n            new Set(notebookIssues.map(i => i.cellIndex))\n          ).length;\n\n          const lines: string[] = [];\n          lines.push('A11Y Analysis Summary');\n          lines.push(`- Total issues: ${total}`);\n          lines.push(`- Cells affected: ${cellsAffected}`);\n\n          const allViolations = Object.entries(byViolation)\n            .sort((a, b) => b[1] - a[1])\n            .map(([v, c]) => `  - ${v}: ${c}`);\n          if (allViolations.length) {\n            lines.push('- Violations:');\n            lines.push(...allViolations);\n          }\n          console.log(lines.join('\\n'));\n        } catch {\n          console.log('Summary Unavailable');\n        }\n\n        if (notebookIssues.length === 0) {\n          issuesContainer.innerHTML =\n            '<div class=\"no-issues\">No issues found</div>';\n          return;\n        }\n\n        // Group issues by category\n        const issuesByCategory = new Map<string, ICellIssue[]>();\n\n        notebookIssues.forEach(notebookIssue => {\n          const categoryName: string =\n            issueToCategory.get(notebookIssue.violationId) || 'Other';\n          if (!issuesByCategory.has(categoryName)) {\n            issuesByCategory.set(categoryName, []);\n          }\n          issuesByCategory.get(categoryName)!.push(notebookIssue);\n        });\n        // Create widgets for each category\n        for (const categoryName of issueCategoryNames) {\n          const categoryIssues: ICellIssue[] =\n            issuesByCategory.get(categoryName) || [];\n\n          if (categoryIssues.length === 0) {\n            continue;\n          }\n\n          const categoryWidget: HTMLDivElement = document.createElement('div');\n          categoryWidget.classList.add('category');\n          categoryWidget.innerHTML = `\n            <h2 class=\"category-title\">${categoryName}</h2>\n            <hr>\n            <div class=\"issues-list\"></div>\n          `;\n\n          const issuesContainer = this.node.querySelector(\n            '.issues-container'\n          ) as HTMLElement;\n          issuesContainer.appendChild(categoryWidget);\n\n          const issuesList: HTMLDivElement = categoryWidget.querySelector(\n            '.issues-list'\n          ) as HTMLDivElement;\n\n          categoryIssues.forEach(issue => {\n            const issueWidget = new CellIssueWidget(\n              issue,\n              this.currentNotebook!.content.widgets[issue.cellIndex],\n              this.aiEnabled,\n              this\n            );\n            issuesList.appendChild(issueWidget.node);\n          });\n        }\n      } catch (error) {\n        issuesContainer.innerHTML = '';\n        console.error('Error analyzing notebook:', error);\n      } finally {\n        analyzeControlButton.innerHTML = analyzeControlButtonText;\n        analyzeControlButton.disabled = false;\n      }\n    });\n\n    // Add event listener for notebookReanalyzed event\n    // Listen on both the panel node and document to ensure we catch bubbled events\n    const handler = async (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const newIssues = customEvent.detail.issues;\n      const isHeadingUpdate = customEvent.detail.isHeadingUpdate;\n      const isTableUpdate = customEvent.detail.isTableUpdate;\n      const isCellUpdate = customEvent.detail.isCellUpdate;\n\n      if (isHeadingUpdate) {\n        // Find the Headings category section\n        const headingsCategory = Array.from(\n          this.node.querySelectorAll('.category-title')\n        )\n          .find(title => title.textContent === 'Headings')\n          ?.closest('.category');\n\n        if (headingsCategory) {\n          // Clear only the issues list in the Headings section\n          const issuesList = headingsCategory.querySelector('.issues-list');\n          if (issuesList) {\n            issuesList.innerHTML = '';\n\n            // Add new heading issues to this section\n            newIssues.forEach((issue: ICellIssue) => {\n              const issueWidget = new CellIssueWidget(\n                issue,\n                this.currentNotebook!.content.widgets[issue.cellIndex],\n                this.aiEnabled,\n                this\n              );\n              issuesList.appendChild(issueWidget.node);\n            });\n          }\n        }\n      } else if (isTableUpdate) {\n        // Find the Tables category section\n        const tablesCategory = Array.from(\n          this.node.querySelectorAll('.category-title')\n        )\n          .find(title => title.textContent === 'Tables')\n          ?.closest('.category');\n\n        if (tablesCategory) {\n          // Clear only the issues list in the Tables section\n          const issuesList = tablesCategory.querySelector('.issues-list');\n          if (issuesList) {\n            issuesList.innerHTML = '';\n\n            // Reanalyze table issues\n            const accessibleCells = notebookToGeneralCells(\n              this.currentNotebook!\n            );\n            const tableIssues = await analyzeTableIssues(accessibleCells);\n\n            // Add new table issues to this section\n            tableIssues.forEach((issue: ICellIssue) => {\n              const issueWidget = new CellIssueWidget(\n                issue,\n                this.currentNotebook!.content.widgets[issue.cellIndex],\n                this.aiEnabled,\n                this\n              );\n              issuesList.appendChild(issueWidget.node);\n            });\n          }\n        }\n      } else if (isCellUpdate) {\n        // Single-cell update: replace only issues from impacted cell(s) per category\n        const incomingIssues = newIssues as ICellIssue[];\n        const issuesByCategory = new Map<string, ICellIssue[]>();\n        incomingIssues.forEach(issue => {\n          const categoryName =\n            issueToCategory.get(issue.violationId) || 'Other';\n          if (!issuesByCategory.has(categoryName)) {\n            issuesByCategory.set(categoryName, []);\n          }\n          issuesByCategory.get(categoryName)!.push(issue);\n        });\n\n        for (const [categoryName, categoryIssues] of issuesByCategory) {\n          // Find or create the category section\n          let categoryEl = Array.from(\n            this.node.querySelectorAll('.category-title')\n          )\n            .find(title => title.textContent === categoryName)\n            ?.closest('.category') as HTMLElement | undefined | null;\n\n          if (!categoryEl) {\n            categoryEl = document.createElement('div');\n            categoryEl.classList.add('category');\n            categoryEl.innerHTML = `\n              <h2 class=\"category-title\">${categoryName}</h2>\n              <hr>\n              <div class=\"issues-list\"></div>\n            `;\n            const container = this.node.querySelector(\n              '.issues-container'\n            ) as HTMLElement;\n            container.appendChild(categoryEl);\n          }\n\n          const issuesList = categoryEl.querySelector(\n            '.issues-list'\n          ) as HTMLElement;\n\n          // Remove existing widgets for impacted cell indices only\n          const impacted = new Set(categoryIssues.map(i => i.cellIndex));\n          Array.from(issuesList.children).forEach(child => {\n            const el = child as HTMLElement;\n            const idxAttr = el.getAttribute('data-cell-index');\n            if (idxAttr && impacted.has(parseInt(idxAttr))) {\n              el.remove();\n            }\n          });\n\n          // Append new issues for this category\n          categoryIssues.forEach(issue => {\n            const issueWidget = new CellIssueWidget(\n              issue,\n              this.currentNotebook!.content.widgets[issue.cellIndex],\n              this.aiEnabled,\n              this\n            );\n            issuesList.appendChild(issueWidget.node);\n          });\n        }\n      }\n    };\n    this.node.addEventListener('notebookReanalyzed', handler as EventListener);\n    //document.addEventListener('notebookReanalyzed', handler as EventListener);\n  }\n\n  private async loadSettings(settingRegistry: ISettingRegistry): Promise<void> {\n    try {\n      const settings = await settingRegistry.load(\n        'jupyterlab-a11y-checker:plugin'\n      );\n\n      if (settings.get('languageModel').composite) {\n        const langModel = settings.get('languageModel').composite as any;\n        this.languageModelSettings = {\n          baseUrl: langModel.baseUrl || this.languageModelSettings.baseUrl,\n          apiKey: langModel.apiKey || this.languageModelSettings.apiKey,\n          model: langModel.model || this.languageModelSettings.model\n        };\n      }\n\n      if (settings.get('visionModel').composite) {\n        const visionModel = settings.get('visionModel').composite as any;\n        this.visionModelSettings = {\n          baseUrl: visionModel.baseUrl || this.visionModelSettings.baseUrl,\n          apiKey: visionModel.apiKey || this.visionModelSettings.apiKey,\n          model: visionModel.model || this.visionModelSettings.model\n        };\n      }\n    } catch (error) {\n      console.warn('Failed to load settings:', error);\n    }\n  }\n\n  getLanguageModelSettings(): IModelSettings {\n    return this.languageModelSettings;\n  }\n\n  getVisionModelSettings(): IModelSettings {\n    return this.visionModelSettings;\n  }\n\n  setNotebook(notebook: NotebookPanel) {\n    this.currentNotebook = notebook;\n\n    const issuesContainer = this.node.querySelector(\n      '.issues-container'\n    ) as HTMLElement;\n    issuesContainer.innerHTML = '';\n  }\n}\n","import { IImageProcessor } from '@berkeley-dsep-infra/a11y-checker-core';\n\nexport class BrowserImageProcessor implements IImageProcessor {\n  loadImage(src: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.crossOrigin = 'Anonymous';\n      img.onload = () => resolve(img);\n      img.onerror = e => reject(new Error(`Failed to load image: ${src}`));\n      img.src = src;\n    });\n  }\n\n  createCanvas(width: number, height: number): HTMLCanvasElement {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { ILabShell } from '@jupyterlab/application';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { MainPanelWidget } from './components/mainpanelWidget.js';\nimport { analyzeCellsAccessibility } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { buildLLMReport } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { IGeneralCell } from '@berkeley-dsep-infra/a11y-checker-core';\nimport { notebookToGeneralCells } from './adapter.js';\nimport { PageConfig } from '@jupyterlab/coreutils';\nimport { BrowserImageProcessor } from './image-processor.js';\n\nconst extension: JupyterFrontEndPlugin<void> = {\n  id: 'jupyterlab-a11y-checker:plugin',\n  autoStart: true,\n  requires: [ILabShell, ISettingRegistry],\n  activate: (\n    app: JupyterFrontEnd,\n    labShell: ILabShell,\n    settingRegistry: ISettingRegistry\n  ) => {\n    const panel = new MainPanelWidget(settingRegistry);\n\n    labShell.add(panel, 'right');\n\n    // Update current notebook when active widget changes\n    labShell.currentChanged.connect(() => {\n      const current = labShell.currentWidget;\n      if (current instanceof NotebookPanel) {\n        panel.setNotebook(current);\n      }\n    });\n\n    app.commands.addCommand('jupyterlab-a11y-checker:scan-notebook', {\n      label: 'Scan Notebook for Accessibility Issues',\n      execute: async () => {\n        const current = labShell.currentWidget;\n        if (current instanceof NotebookPanel) {\n          const accessibleCells: IGeneralCell[] =\n            notebookToGeneralCells(current);\n\n          const issues = await analyzeCellsAccessibility(\n            accessibleCells,\n            document,\n            PageConfig.getBaseUrl(),\n            new BrowserImageProcessor(),\n            current.context.path\n          );\n          return buildLLMReport(issues);\n        }\n        return [];\n      }\n    });\n  }\n};\n\nexport default extension;\n"],"names":[],"sourceRoot":""}